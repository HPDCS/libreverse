/*
x86 Length Disassembler test.
Copyright (C) 2013 Byron Platt

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <stdio.h>
#include <string.h>

#include "ld32.h"

/* This is some test code, taken from a disassembly of the Linux Kernel scheduler */
unsigned char bytecode[] = {0x0f,0x1f,0x44,0x00,0x00,0x55,0x48,0x89,0xe5,0x41,0x56,0x41,0x55,0x41,
							0x54,0x49,0x89,0xfc,0x53,0x48,0xc7,0xc3,0xc0,0x5d,0x01,0x00,0x65,0x48,
							0x03,0x1d,0xa6,0xb9,0xf7,0x7e,0x4c,0x8b,0xab,0x30,0x09,0x00,0x00,0x48,
							0xc7,0x83,0x30,0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x4c,0x8b,0x37,0x65,
							0x48,0x8b,0x34,0x25,0xc0,0xb8,0x00,0x00,0x0f,0x1f,0x44,0x00,0x00,0x41,
							0xc7,0x44,0x24,0x28,0x00,0x00,0x00,0x00,0xe9,0x2d,0x00,0x00,0x00,0x66,
							0x83,0x03,0x02,0xfb,0x66,0x0f,0x1f,0x44,0x00,0x00,0x4d,0x85,0xed,0x74,
							0x07,0xf0,0x41,0xff,0x4d,0x4c,0x74,0x46,0x49,0x83,0xfe,0x40,0x74,0x4a,
							0x48,0x89,0xd8,0x5b,0x41,0x5c,0x41,0x5d,0x41,0x5e,0x5d,0xc3,0x0f,0x1f,
							0x40,0x00,0xb8,0x02,0x00,0x00,0x00,0xf0,0x66,0x0f,0xc1,0x03,0xa8,0x01,
							0x74,0xc9,0x83,0xe0,0xfe,0x48,0x89,0xdf,0x8d,0x70,0x02,0x0f,0xb7,0xf6,
							0xe8,0xa1,0x27,0xf8,0xff,0x66,0x90,0xeb,0xb4,0x0f,0x1f,0x44,0x00,0x00,
							0xe8,0xb3,0xf7,0x0b,0x00,0xeb,0x96,0x90,0x4c,0x89,0xef,0xe8,0x18,0x82,
							0xfd,0xff,0xeb,0xb0,0x49,0x8b,0x44,0x24,0x60,0x48,0x8b,0x80,0x98,0x00,
							0x00,0x00,0x48,0x85,0xc0,0x74,0x05,0x4c,0x89,0xe7,0xff,0xd0,0x4c,0x89,
							0xe7,0xe8,0x78,0x7e,0x07,0x00,0xf0,0x41,0xff,0x4c,0x24,0x10,0x74,0x02,
							0xeb,0x8e,0x4c,0x89,0xe7,0xe8,0x36,0x87,0xfd,0xff,0xeb,0x84,0x0f,0x1f,
							0x40,0x00};

int main(void) {
    int i, j;
    unsigned char *opcode = bytecode;
    unsigned int length;

    for (i=0; i < sizeof(bytecode); i += length) {
        length = length_disasm(opcode);
		printf("%03d: ", i);
		for(j = 0; j < length; j++)
			printf("%02x ", *opcode++);
		printf("\n");
    }

    return 0;
}
